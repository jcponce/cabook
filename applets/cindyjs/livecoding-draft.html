<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Complex Functions with CindyJS - Live Coding</title>
    <link rel="icon" href="assets/img/logo_small.png" type="image/png">
    <link rel="stylesheet" href="assets/app.css" />
    <link rel="stylesheet" href="assets/CindyJS.css" />
  </head>
  <body class="with-footer">

    <!-- Header
    <header id="top-bar">
      <div>
        <h1><a href="/"><span style="font-weight:400">Cindy</span><span style="font-weight:700">JS</span><img alt="CindyJS logo" class="logo" src="/assets/img/logo_small.png"></a></h1>
        <nav>
          <ul id="topBarLinks">
            <li><a href="/gallery/main/">Gallery</a></li>
            <li><a href="/docs/">Docs</a></li>
            <li><a href="/project/">Project</a></li>
            <li><a href="https://github.com/CindyJS/CindyJS"><img src="/assets/img/octoicons-mark-github.svg" alt="GitHub" title="GitHub project" style="display:inline; position:relative; top:0.2ex; width:1.7ex;"></a></li>
          </ul>
        </nav>
      </div>
    </header>-->

    <div id="between-bars">

      <!-- Main part -->
      <main>

        <h1>Complex Functions with CindyJS - Live Coding</h1>

<script src="https://codemirror.net/lib/codemirror.js"></script>
<script src="https://codemirror.net/mode/clike/clike.js"></script>
<script src="https://codemirror.net/addon/edit/matchbrackets.js"></script>
<script src="https://codemirror.net/addon/edit/closebrackets.js"></script>
<link rel="stylesheet" property="stylesheet" type="text/css" href="https://codemirror.net/lib/codemirror.css">
<link rel="stylesheet" property="stylesheet" type="text/css" href="https://codemirror.net/theme/zenburn.css">
<link rel="stylesheet" property="stylesheet" type="text/css" href="https://cindyjs.org/docs/cindygltutorial/livecoding.css">
<link rel="stylesheet" property="stylesheet" type="text/css" href="https://cindyjs.org/docs/cindygltutorial/centerimg.css">
<script type="text/javascript" async  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" src="assets/Cindy.js"></script>
<script type="text/javascript" src="assets/CindyGL.js"></script>
<script id="csinit" type="text/x-cindyscript">
drawcmd() := (
  colorplot([0.7,0.3,0]);
);
resetclock();
</script>
<script id="csdraw" type="text/x-cindyscript">
drawcmd();
</script>
<div id="appletcontainer">
  <div id="applet">
    <div id="code"></div>
    <div id="CSCanvas"></div>
    <button id="fs">Enter fullscreen</button>
  </div>
</div>
<script type="text/javascript">
window.onload = function() {
  var cdy = CindyJS({
    ports: [{
      id: "CSCanvas",
      transform: [{visibleRect:[-2,2,2,-2]}],
      background: "rgb(100,100,100)"
    }],
    scripts: "cs*",
    autoplay: true,
    use: ["CindyGL"],
    language: "en"
  });

  var btn = document.getElementById("fs");
  var div = document.getElementById("applet");
  btn.onclick = function() {
    (div.requestFullscreen ||
     div.webkitRequestFullscreen ||
     div.mozRequestFullScreen ||
     div.msRequestFullscreen ||
     function(){}).call(div);
  };


  var myCodeMirror = CodeMirror(document.getElementById("code"), {
    value: `colorplot( (0.7,0.3,0) );`,
    autoCloseBrackets: true,
    matchBrackets: true,
    //lineNumbers: true,
    lineWrapping: true,
    theme: "zenburn"
  });

  myCodeMirror.on("change", function(cm, change) {
    console.log("something changed! (" + change.origin + ")");
    cdy.evokeCS(`drawcmd() := (
      ${cm.getValue()}
      )`);
  });

  var codes = document.getElementsByClassName("lang-cindyscript");
  for(i in codes) {
    codes[i].parentElement.onclick = function(e) {
      console.log(this.innerText);
      myCodeMirror.setValue(this.innerText.trim())
    }
  }
}
</script>

<hr>

<h3 id="complex-phase-portraits-">Complex phase portraits</h3>

<p>Generating phase portraits can be easily done on the GPU using the command <code>colorplot</code> which assigns a color to each pixel given a function.</p>

<p>First let us define a complex function $f:\mathbb{C}\to\mathbb{C}$. A interesting function could be $f(z)=z^5-1$, which should have the five roots $\exp({k \tfrac{2 \pi i}{5}})$ for $k\in\{0,1,2,3,4\}$. We define $f$ in CindySript with <code>f(z):=z^5-1</code>.</p>
<p>CindyJS supports complex numbers and all its operations without additional implementations. One could evaluate <code>f(i)</code> and get $f(i)=i^5-1=i-1$:</p>
<pre><code class="lang-cindyscript">f(z):=z^5-1;
drawtext((0,0), f(i));
</code></pre>
<p>Now we want to build a colorplot that interprets each pixel coordinate <code>#</code> as a complex number <code>z</code>, evaluates <code>f(z)</code> and colorizes the complex number <code>f(z)</code> according to the image above.</p>
<p>In order to interpret <code>#</code> has complex number <code>z</code> one can either write <code>z=#.x + i*#.y</code> or use the equivalent function <code>z=complex(#)</code>, which converts 2-component vectors of real numbers to a single complex number. Then we evaluate $f(z)$ and save it to the variable <code>fz</code> with <code>fz=f(z)</code>. Now, in oder to colorize it, we will <a href="https://en.wikipedia.org/wiki/Atan2"> use the <code>arctan2</code> function</a>, which can also applied to complex numbers, to obtain the angle/phase of <code>fz</code> and plug the rescaled angle in the <code>hue</code> function:</p>
<pre><code class="lang-cindyscript">f(z) := z^5-1; //a complex function
colorplot(
    z = complex(#);
    fz = f(z);
    hue(arctan2(fz)/(2*pi))
);
</code></pre>


<br>
<hr>
<br>

<h3 id="complex-phase-portraits-">Enhanced phase portraits</h3>

<p>The visualization can be enhanced if lines of the same phase and modulus are highlighted. To generate the image above, The following more complicated helper function <code>colorize</code> can be used that gives colors to complex numbers:</p>
<pre><code class="lang-cindyscript">f(z) := z; //a complex function
colorize(z) := (
  n = 12; //highlight 12 different phases
  z = log(z)/(2*pi);
  zfract = n*z - floor(n*z); //n*z in C mod Z[i]
  factor = (.6+.4*re(sqrt(im(zfract)*re(zfract))));
  hue(im(z))*factor; //darken hue wrt factor
);
colorplot( colorize(f(complex(#))) );
</code></pre>
<p>The trick in designing <code>colorize</code> is to notice that the imaginary part of the logarithm of a complex number corresponds to the argument of the complex number, while the real part of the logarithm equals to the logarithm of the modulus of the complex number. By adding a grid over the values obtained by taking the logarithm, a grid that has iso-lines on phases and moduli is obtained. You might have wondered why there is a <code>re</code> in <code>re(sqrt(...))</code> in the code above? The problem is that CindyGL needs to be able to prove the types of all occurring variables and a colorplot should return a real color vector. If one takes the square-root of a real number, then the result, in general, is complex. To guarantee CindyGL that <code>factor</code> will always be real, we take the real part of the square-root.</p>
<p>Now is maybe a nice time to play around with other complex functions. For example, what happens for <code>f(z):=(z+1)/(z-1)</code>, <code>f(z):=sin(z)</code>, <code>f(z):=z^(complex(mouse()))</code>...?</p>
<br>
<hr>
<br>

<h3 id="plotting-the-mandelbrot-set">Plotting the Mandelbrot set</h3>
<p>An application that is almost tailored to the <code>colorplot</code>-command is the visualization of the Mandelbrot set. The Mandelbrot set contains all those points $c\in\mathbb{C}$ such that the iteration $z_{n+1} = z_n^2+c$ starting with $z_0 = 0$ is bounded.</p>
<p>A simple algorithm for plotting the Mandelbrot set is known as the &quot;escape time&quot; algorithm. It is based on the observation that whenever there is a term in the sequence having an absolute value larger than 2, <a href="http://mrob.com/pub/muency/escaperadius.html">the sequence $z_n$ can be proven to be unbounded</a>. So we will compute the sequence $z_n$ for every pixel having the complex coordinate $c$  for a while and check whether it will leave the circle of radius 2. The number <code>n</code> of steps that the orbit remains within the circle of radius 2 is a possible ingredient for a visualization.</p>
<pre><code class="lang-cindyscript">N = 30; // maximal number of iterations
colorplot(
  c = complex(#)-0.75; //center -0.75+0*i
  z = 0;
  n = 0;
  repeat(N, k,
    if(|z| &lt;= 2,  // if we are inside circle,
       z=z*z+c; // then iterate and
       n = k;   // increase n
    );
  );
  grey(n/N); // the last line is the return-value!
);
</code></pre>
<p>The earlier we leave the circle of radius two, the smaller is <code>n</code> and the darker is <code>grey(n/N)</code></p>

<p>For a given $c\in\mathbb{C}$ (for instance, <code>c=-0.4+0.6*i</code> or the mouse-coordinate), can you color-plot the filled Julia and Fatou set of the function $z^2+c$? That is the set of all points $z\in \mathbb{C}$ such that the orbit $z_{n+1} = z_n^2+c$ starting with $z_0 = z$ is bounded.</p>

<!--
 N = 120; // maximal number of iterations
 colorplot(
 z = complex(#)-0.75; //center -0.75+0*i
 z = z;
 n = 0;
 repeat(N, k,
 if(|z| <= 2,  // if we are inside circle,
 z=z*z+complex(mouse()); // then iterate and
 n = k;   // increase n
 );
 );
 grey(n/N); // the last line is the return-value!
 );
 -->
<br>
<hr>
<br>

<h2 id="wrapping-up">What is CindyJS?</h2>

<p>CindyJS is a framework to create interactive (mathematical) content for the web. It  provides the high-level mathematically oriented user with access to the shader language of the GPU without learning a shader language.</p>

<p>Do you want to learn more? Then go to <a href="https://cindyjs.org/">Cindyjs.org</a></p>


      </main>
    </div>

    <footer id="bottom-bar">
      <div>
        <div class="footer-item">
          <p class="footer-label">Made possible by:</p>
          <ul class="footer-links">
            <li><a href="http://ma.tum.de/">Technische Universität München, Zentrum Mathematik, Germany</a></li>
            <li><a href="http://discretization.de/">DFG SFB Transregio 109 DGD, Germany</a></li>
            <li><a href="http://mc2-project.eu/">M C Squared, 7th Framework Programme, EU</a></li>
          </ul>
          <p class="footer-label"><a href="/imprint/">Legal notice and privacy policy</a></p>
        </div>
        <div class="footer-sep"><hr></div>
        <div class="footer-item">
          <p class="footer-label">This page:</p>
          <ul class="footer-links">
            <li><a href="https://github.com/CindyJS/website/blob/master/src/pages/docs/cindygltutorial/livecoding.md">View source</a></li>
            <li><a href="https://github.com/CindyJS/website/edit/master/src/pages/docs/cindygltutorial/livecoding.md">Edit page</a></li>
            <li><a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license">CC-BY-SA 4.0 License
              <img src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="CC-BY-SA 4.0 License">
            </a></li>
          </ul>
        </div>
      </div>
    </footer>

    <script src="/assets/app.js"></script>
  </body>
</html>
